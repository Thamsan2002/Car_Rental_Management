@model List<Car_Rental_Management.Dtos.CarDto>
@{
    ViewData["Title"] = "Home";
    var userId = ViewBag.UserId as Guid?;
}

<!-- Hero Slider -->
<section id="home" class="hero">
    <div class="slider">
        <div class="slide active">
            <img src="~/images/car02.cs.jpg" alt="Car 1" />
            <div class="slide-text">
                <h1>Drive Your Dream Car</h1>
                <p>Premium Cars at Affordable Prices</p>
                @if (userId.HasValue)
                {
                    <a asp-action="Create" asp-controller="Booking" class="custom-btn">Book Now</a>
                }
                else
                {
                    <a asp-action="Login" asp-controller="Customer" class="custom-btn">Book Now</a>
                }
            </div>
        </div>
        <div class="slide">
            <img src="~/images/car07.jpg" alt="Car 2" />
            <div class="slide-text">
                <h1>Luxury & Comfort</h1>
                <p>Experience the best ride</p>
                <a href="#cars" class="custom-btn warning">View Cars</a>
             
            </div>
        </div>
        <div class="slide">
            <img src="~/images/car6.jpg" alt="Car 3" />
            <div class="slide-text">
                <h1>Luxury & Comfort</h1>
                <p>Experience the best ride</p>
                <a asp-action="Index" asp-controller="Car" class="custom-btn warning">View Cars</a>
            </div>
        </div>
    </div>
</section>

<!-- Clients Section -->
<section id="clients" class="clients py-4 text-center">
    <div class="container d-flex justify-content-center flex-wrap gap-4">
        <img src="~/images/honda.jpg" alt="Honda" height="50" data-brand="Honda" class="brand-icon" />
        <img src="~/images/bmw.jpg" alt="BMW" height="50" data-brand="BMW" class="brand-icon" />
        <img src="~/images/tata.jpg" alt="TATA" height="50" data-brand="TATA" class="brand-icon" />
        <img src="~/images/audi.jpg" alt="Audi" height="50" data-brand="Audi" class="brand-icon" />
        <img src="~/images/allbrands.png" alt="All Brands" height="50" data-brand="All" class="brand-icon" />
    </div>
</section>

<!-- Cars Section -->
<section id="cars" class="cars-section py-5">
    <div class="container">
        <div class="section-header">
            <h2>Available Cars</h2>
            <p>Choose your ride from our premium collection</p>
        </div>
        <div class="row g-4">
            @foreach (var car in Model)
            {
                <div class="col-md-4 car-card-wrapper" data-brand="@car.Make">
                    <div class="car-card">
                        <img src="@(car.ImageUrls?.FirstOrDefault() ?? "/uploads/images/noimage.jpg")" class="w-100" />
                        <div class="p-3">
                            <h5 class="text-white">@car.Make @car.Model (@car.Year)</h5>
                            <p class="text-light">Price: @(car.Price.HasValue ? $"LKR {car.Price.Value:N0}" : "N/A")</p>

                            @if (userId.HasValue)
                            {
                                <a asp-controller="Booking" asp-action="Create" asp-route-id="@car.Id" class="custom-btn">Book Now</a>
                            }
                            else
                            {
                                <a asp-controller="Customer" asp-action="Login" class="btn btn-primary">Book Now</a>

                            }

                            <button class="custom-btn mt-2" onclick="openCarPopup('@car.Id')">Details</button>
                        </div>
                    </div>

                    <div class="car-popup" id="carPopup_@car.Id">
                        <div class="car-popup-content">
                            <span class="close-btn" onclick="closeCarPopup('@car.Id')">&times;</span>
                            <div id="slider_@car.Id" class="image-slider">
                                @foreach (var img in car.ImageUrls ?? new List<string>())
                                {
                                    <img src="@img" class="Animation" />
                                }
                                <button class="prev" onclick="prevSlide('@car.Id')">&#10094;</button>
                                <button class="next" onclick="nextSlide('@car.Id')">&#10095;</button>
                            </div>

                            <div class="car-details">
                                <p><strong>Make:</strong> @car.Make</p>
                                <p><strong>Model:</strong> @car.Model</p>
                                <p><strong>Year:</strong> @car.Year</p>
                                <p><strong>Seats:</strong> @car.Seats</p>
                                <p><strong>Transmission:</strong> @car.Transmission</p>
                                <p><strong>Fuel:</strong> @car.Fuel</p>
                                <p><strong>Mileage:</strong> @car.Mileage</p>
                                <p><strong>Color:</strong> @car.Color</p>
                                <p><strong>Description:</strong> @car.Description</p>
                                <p><strong>Price:</strong> @(car.Price.HasValue ? $"LKR {car.Price.Value:N0}" : "N/A")</p>

                                @if (userId.HasValue)
                                {
                                    <a asp-controller="Booking" asp-action="Create" asp-route-id="@car.Id" class="custom-btn">Book Now</a>
                                }
                                else
                                {

                                    <a asp-controller="Customer" asp-action="Login" class="btn btn-primary mt-2">Book Now</a>

                                }
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>
</section>


<!-- About Section -->
<section id="about" class="about white-text">
    <div class="container">
        <div class="section-header">
            <h2 class="text-white">About US</h2>
            <p class="text-white">
                For over 1 years, KTS has been the trusted choice for car rentals worldwide.
                We're committed to providing exceptional vehicles and outstanding service
                to make every journey memorable.
            </p>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-users"></i>
                </div>
                <div class="stat-number" data-target="50000">0</div>
                <div class="stat-label">Happy Customers</div>
            </div>

            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-car"></i>
                </div>
                <div class="stat-number" data-target="1500">0</div>
                <div class="stat-label">Vehicles Available</div>
            </div>

            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-map-marker-alt"></i>
                </div>
                <div class="stat-number" data-target="100">0</div>
                <div class="stat-label">Locations Worldwide</div>
            </div>

            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-award"></i>
                </div>
                <div class="stat-number" data-target="15">0</div>
                <div class="stat-label">Years of Excellence</div>
            </div>
        </div>
    </div>
</section>

<!-- Services Section -->
<section id="services" class="services">
    <div class="container">
        <div class="section-title" data-aos="fade-up">
            <h2>Our Services</h2>
            <p>We offer the best car rental services to suit your needs</p>
        </div>

        <div class="service-box">
            <div class="service" data-aos="zoom-in" data-aos-delay="100">
                <h3>Daily Car Rentals</h3>
                <p>Flexible daily rental options with affordable prices.</p>
            </div>
            <div class="service" data-aos="zoom-in" data-aos-delay="200">
                <h3>Long-Term Leasing</h3>
                <p>Special packages for monthly or yearly rentals.</p>
            </div>
            <div class="service" data-aos="zoom-in" data-aos-delay="300">
                <h3>Luxury Cars</h3>
                <p>Premium cars for weddings, business trips, and events.</p>
            </div>
            <div class="service" data-aos="zoom-in" data-aos-delay="400">
                <h3>24/7 Support</h3>
                <p>We are always available to assist with your booking.</p>
            </div>
        </div>
    </div>
</section>


<!-- Features Section -->
<section id="features" class="py-5" style="background:#f8f8f8;">
    <div class="container">
        <h2 class="text-center mb-5" data-aos="fade-down">Why Choose KTS?</h2>
        <div class="row g-4">
            <div class="col-md-4" data-aos="zoom-in">
                <div class="feature-box">
                    <i class="fas fa-car"></i>
                    <h4>Wide Selection</h4>
                    <p>From economy to luxury, we offer a wide range of cars to suit your needs.</p>
                </div>
            </div>
            <div class="col-md-4" data-aos="zoom-in" data-aos-delay="200">
                <div class="feature-box">
                    <i class="fas fa-tags"></i>
                    <h4>Affordable Pricing</h4>
                    <p>Transparent pricing with no hidden fees. Rent with confidence.</p>
                </div>
            </div>
            <div class="col-md-4" data-aos="zoom-in" data-aos-delay="400">
                <div class="feature-box">
                    <i class="fas fa-headset"></i>
                    <h4>24/7 Support</h4>
                    <p>Our support team is here to help you anytime, anywhere.</p>
                </div>
            </div>
        </div>
    </div>
</section>


@await Html.PartialAsync("_Contact", model: null)

@section Scripts {
    <script src="/js/Home.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function(){

            // Hero Slider
            const slides=document.querySelectorAll(".slide"); let current=0;
            function nextSlide(){ slides[current].classList.remove("active"); current=(current+1)%slides.length; slides[current].classList.add("active"); }
            setInterval(nextSlide,5000);

            // Car popup slider
            class CarSlider{
                constructor(carId, delay=3000){
                    this.slider=document.getElementById(`slider_${carId}`);
                    if(!this.slider) return;
                    this.slides=this.slider.querySelectorAll('.Animation');
                    this.current=0;
                    this.prev=this.slider.querySelector('.prev');
                    this.next=this.slider.querySelector('.next');
                    this.prev.addEventListener('click',()=>this.prevSlide());
                    this.next.addEventListener('click',()=>this.nextSlide());
                    this.show(this.current);
                    this.interval=setInterval(()=>this.nextSlide(), delay);
                }
                show(index){ this.slides.forEach((s,i)=>s.style.display=(i==index?'block':'none')); this.current=index; }
                nextSlide(){ this.show((this.current+1)%this.slides.length); }
                prevSlide(){ this.show((this.current-1+this.slides.length)%this.slides.length); }
            }
            @foreach (var car in Model)
            {
                    <text>new CarSlider("@car.Id");</text>
            }

            function openCarPopup(id){ document.getElementById(`carPopup_${id}`).style.display='block'; }
            function closeCarPopup(id){ document.getElementById(`carPopup_${id}`).style.display='none'; }

            // Brand Filter
            const clientImgs = document.querySelectorAll('.brand-icon');
            const carCards = document.querySelectorAll('.car-card-wrapper');

            clientImgs.forEach(img => {
                img.addEventListener('click', function(){
                    // Highlight active
                    clientImgs.forEach(i=>i.classList.remove('active-brand'));
                    this.classList.add('active-brand');

                    const brand = this.dataset.brand;
                    carCards.forEach(card => {
                        if(brand === "All" || card.dataset.brand === brand){
                            card.style.display = "block";
                        } else {
                            card.style.display = "none";
                        }
                    });
                });
            });

        });
    </script>
}

<style>
    /* Brand icons same size + hover */
    .brand-icon {
        width: 60px;
        height: 60px;
        object-fit: contain;
        filter: grayscale(100%);
        transition: transform 0.3s, filter 0.3s;
        cursor: pointer;
        border-radius: 8px;
    }

        .brand-icon:hover, .active-brand {
            transform: scale(1.2);
            filter: grayscale(0%);
        }
</style>
