@model List<Car_Rental_Management.Dtos.CarDto>
@{
    ViewData["Title"] = "Home";
    var userId = ViewBag.UserId as Guid?;
}

<!-- Hero Slider -->
<section id="home" class="hero">
    <div class="slider">
        <div class="slide active">
            <img src="~/images/car3.jpg" alt="Car 1" />
            <div class="slide-text">
                <h1>Drive Your Dream Car</h1>
                <p>Premium Cars at Affordable Prices</p>
                @if (userId.HasValue)
                {
                    <a asp-action="Booking" asp-controller="Booking" class="btn btn-success">Book Now</a>
                }
                else
                {
                    <a asp-action="Login" asp-controller="Customer" class="btn btn-primary">Book Now</a>
                }
            </div>
        </div>
        <div class="slide">
            <img src="~/images/car2.jpg" alt="Car 2" />
            <div class="slide-text">
                <h1>Luxury & Comfort</h1>
                <p>Experience the best ride</p>
                <a asp-action="Index" asp-controller="Car" class="btn btn-warning">View Cars</a>
            </div>
        </div>
    </div>
</section>

<!-- Clients -->
<section id="clients" class="clients py-4 text-center">
    <div class="container d-flex justify-content-center flex-wrap gap-4">
        <img src="~/images/logo01.jpg" alt="Brand 1" height="50" />
        <img src="~/images/logo02.jpg" alt="Brand 2" height="50" />
        <img src="~/images/logo03.jpg" alt="Brand 3" height="50" />
        <img src="~/images/logo01.jpg" alt="Brand 3" height="50" />
        <img src="~/images/logo04.jpg" alt="Brand 3" height="50" />
    </div>
</section>

<!-- Offers - Customer Only -->
@if (userId.HasValue)
{
    <section id="offers" class="offers py-5" style="background:#fff8e1;">
        <div class="container">
            <h3 class="text-center mb-4">🔥 Special Offers</h3>
            <div id="offersCarousel" class="carousel slide" data-bs-ride="carousel">
                <div class="carousel-inner d-flex">
                    <div class="carousel-item active">
                        <div class="offer-card text-center p-4 rounded shadow-sm" style="background:#fffbe6;">
                            <h4>Weekend Special: Rent 1 Day, Get 10% Off!</h4>
                            <p>Book your dream car this weekend and enjoy exclusive discounts.</p>
                            <a asp-controller="Booking" asp-action="Booking" class="btn btn-warning">Book Now</a>
                        </div>
                    </div>
                    <div class="carousel-item">
                        <div class="offer-card text-center p-4 rounded shadow-sm" style="background:#ffe6e6;">
                            <h4>Luxury Ride: 15% Off for First Booking</h4>
                            <p>Experience premium cars at a discounted rate for your first booking.</p>
                            <a asp-controller="Booking" asp-action="Booking" class="btn btn-warning">Book Now</a>
                        </div>
                    </div>
                    <div class="carousel-item">
                        <div class="offer-card text-center p-4 rounded shadow-sm" style="background:#e6f7ff;">
                            <h4>Midweek Madness: Flat LKR 500 Off</h4>
                            <p>Rent any car from Monday to Wednesday and save instantly.</p>
                            <a asp-controller="Booking" asp-action="Booking" class="btn btn-warning">Book Now</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
}

<!-- Cars Section -->
<section id="cars" class="py-5">
    <div class="container">
        <h2 class="text-center mb-4">Available Cars</h2>
        <div class="row g-4">
            @foreach (var car in Model)
            {
                <div class="col-md-4">
                    <div class="card shadow-sm">
                        <img src="@(car.ImageUrls?.FirstOrDefault() ?? "/uploads/images/noimage.jpg")" class="card-img-top" />
                        <div class="card-body">
                            <h5>@car.Make @car.Model (@car.Year)</h5>
                            <p>Price: @(car.Price.HasValue ? $"LKR {car.Price.Value:N0}" : "N/A")</p>
                            @if (userId.HasValue)
                            {
                                <a asp-controller="Booking" asp-action="Booking" asp-route-id="@car.Id" class="btn btn-success">Book Now</a>
                            }
                            else
                            {
                                <a asp-controller="Customer" asp-action="Login" class="btn btn-primary">Book Now</a>
                            }
                            <button class="btn btn-info mt-2" onclick="openCarPopup('@car.Id')">Details</button>
                        </div>
                    </div>

                    <!-- Full Page Car Popup with All Details -->
                    <div class="car-popup-overlay" id="carPopup_@car.Id" style="display:none;">
                        <div class="popup-content p-4 position-relative">
                            <button class="btn btn-secondary mb-3" onclick="closeCarPopup('@car.Id')">Back</button>
                            <div id="slider_@car.Id" class="image-slider position-relative">
                                @foreach (var img in car.ImageUrls ?? new List<string>())
                                {
                                    <img src="@img" class="Animation w-100" style="display:none;" />
                                }
                                <button class="prev btn btn-secondary position-absolute top-50 start-0 translate-middle-y" onclick="prevSlide('@car.Id')">&#10094;</button>
                                <button class="next btn btn-secondary position-absolute top-50 end-0 translate-middle-y" onclick="nextSlide('@car.Id')">&#10095;</button>
                            </div>
                            <div class="car-details mt-3">
                                <p><strong>Make:</strong> @car.Make</p>
                                <p><strong>Model:</strong> @car.Model</p>
                                <p><strong>Year:</strong> @car.Year</p>
                                <p><strong>Seats:</strong> @car.Seats</p>
                                <p><strong>Transmission:</strong> @car.Transmission</p>
                                <p><strong>Fuel:</strong> @car.Fuel</p>
                                <p><strong>Mileage:</strong> @car.Mileage</p>
                                <p><strong>Color:</strong> @car.Color</p>
                                <p><strong>Description:</strong> @car.Description</p>
                                <p><strong>Price:</strong> @(car.Price.HasValue ? $"LKR {car.Price.Value:N0}" : "N/A")</p>
                                @if (userId.HasValue)
                                {
                                    <a asp-controller="Booking" asp-action="Booking" asp-route-id="@car.Id" class="btn btn-success mt-2">Book Now</a>
                                }
                                else
                                {
                                    <a asp-controller="Customer" asp-action="Login" class="btn btn-primary mt-2">Book Now</a>
                                }
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>
</section>

<!-- About Section -->
@await Html.PartialAsync("_About", model: null)


<!-- Features Section -->
<section id="features" class="py-5" style="background:#f8f8f8;">
    <div class="container">
        <h2 class="text-center mb-5" data-aos="fade-down">Why Choose KTS?</h2>
        <div class="row g-4">
            <div class="col-md-4" data-aos="zoom-in">
                <div class="feature-box">
                    <i class="fas fa-car"></i>
                    <h4>Wide Selection</h4>
                    <p>From economy to luxury, we offer a wide range of cars to suit your needs.</p>
                </div>
            </div>
            <div class="col-md-4" data-aos="zoom-in" data-aos-delay="200">
                <div class="feature-box">
                    <i class="fas fa-tags"></i>
                    <h4>Affordable Pricing</h4>
                    <p>Transparent pricing with no hidden fees. Rent with confidence.</p>
                </div>
            </div>
            <div class="col-md-4" data-aos="zoom-in" data-aos-delay="400">
                <div class="feature-box">
                    <i class="fas fa-headset"></i>
                    <h4>24/7 Support</h4>
                    <p>Our support team is here to help you anytime, anywhere.</p>
                </div>
            </div>
        </div>
    </div>
</section>



@await Html.PartialAsync("_Contact", model: null)



@section Scripts {
    <script>
        document.addEventListener("DOMContentLoaded", function(){
            // AOS
            AOS.init({duration:1000, once:false});

            // Hero Slider
            const slides=document.querySelectorAll(".slide"); let current=0;
            function nextSlide(){ slides[current].classList.remove("active"); current=(current+1)%slides.length; slides[current].classList.add("active"); }
            setInterval(nextSlide,5000);

            // Offers Carousel - auto loop
            var offersCarousel=document.querySelector('#offersCarousel');
            if(offersCarousel){
                new bootstrap.Carousel(offersCarousel, {interval:2500, ride:'carousel', wrap:true});
            }

            // Car Popup Slider
            class CarSlider{
                constructor(carId, delay=3000){
                    this.slider=document.getElementById(`slider_${carId}`);
                    if(!this.slider) return;
                    this.slides=this.slider.querySelectorAll('.Animation');
                    this.current=0;
                    this.prev=this.slider.querySelector('.prev');
                    this.next=this.slider.querySelector('.next');
                    this.prev.addEventListener('click',()=>this.prevSlide());
                    this.next.addEventListener('click',()=>this.nextSlide());
                    this.show(this.current);
                    this.interval=setInterval(()=>this.nextSlide(), delay);
                }
                show(index){ this.slides.forEach((s,i)=>s.style.display=(i==index?'block':'none')); this.current=index; }
                nextSlide(){ this.show((this.current+1)%this.slides.length); }
                prevSlide(){ this.show((this.current-1+this.slides.length)%this.slides.length); }
            }
            @foreach (var car in Model)
            {
                    <text>new CarSlider("@car.Id");</text>
            }
        });

        // Car popup open/close
        function openCarPopup(id){ document.getElementById(`carPopup_${id}`).style.display='block'; }
        function closeCarPopup(id){ document.getElementById(`carPopup_${id}`).style.display='none'; }
    </script>

    <style>
        .car-popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.85);
            z-index: 9999;
            overflow-y: auto;
        }

        .popup-content {
            background: #fff;
            margin: 50px auto;
            max-width: 900px;
            border-radius: 8px;
            padding: 20px;
            position: relative;
        }

        .image-slider img {
            max-height: 400px;
            object-fit: cover;
        }

        .prev, .next {
            background: rgba(0,0,0,0.5);
            color: #fff;
            border: none;
            padding: 10px;
            cursor: pointer;
        }
    </style>
}
